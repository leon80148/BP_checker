# ESP32 血壓機轉發器使用手冊

**支援血壓機型號：目前僅支援 OMRON-HBP9030**

## 一、產品概述

ESP32 血壓機轉發器是一款可以連接血壓機並通過WiFi網絡分享數據的設備。它可以讀取血壓機測量結果，並在網頁上實時顯示，同時保存歷史記錄以便追蹤健康趨勢。適用於家庭健康監測、遠距醫療和醫療機構數據收集。

### 主要功能
- 即時接收並解析血壓機數據 (OMRON-HBP9030)
- 網頁界面實時顯示測量結果
- 保存歷史記錄並提供查詢功能
- 顯示原始數據以便分析
- 記錄準確的測量時間（台北時區）

## 二、基本安裝與設置

### 1. 硬件連接
- 將ESP32-S3開發板連接到電源
- 使用TTL串口接口連接ESP32和血壓機（連接到GPIO44/43引腳）
  - RX: GPIO44（接收資料）
  - TX: GPIO43（發送資料）

### 2. 首次啟動設置
- 首次開機時，設備會自動創建名為`ESP32_BP_checker`的WiFi熱點
- 使用手機或電腦連接此熱點，密碼為`12345678`
- 連接成功後，使用瀏覽器訪問`192.168.4.1`進入設置頁面

### 3. 配置WiFi連接
- 在設置頁面輸入您家中或辦公室的WiFi名稱和密碼
- 點擊「儲存並連接」按鈕
- 設備會重新啟動並嘗試連接到您設置的WiFi網絡
- 連接成功後，您可以通過以下方式訪問設備：
  - `http://bp_checker.local`（需支持mDNS的設備）
  - 或直接使用設備獲得的IP地址

## 三、日常使用

### 1. 血壓數據監測
- 連接到與ESP32相同的WiFi網絡
- 在瀏覽器中輸入`http://bp_checker.local`或ESP32的IP地址
- 主頁面將顯示三個主要區塊：
  - 最新血壓數據（收縮壓、舒張壓和脈搏）
  - 最近5筆血壓記錄表格
  - 原始數據顯示區

### 2. 進行血壓測量
- 確保ESP32已連接到血壓機且兩者均已開啟
- 按照血壓機的使用說明進行測量
- 測量完成後，數據會自動傳輸到ESP32並顯示在網頁上
- 系統會自動將數據保存到歷史記錄中，並記錄測量時間（台北時區）
- 異常數值（如高血壓）將以紅色標記提醒注意

### 3. 查看歷史記錄
- 在主頁面點擊「查看歷史記錄」按鈕
- 系統會顯示最近測量的血壓數據列表（最多20筆）
- 每筆記錄都會顯示準確的測量時間（年-月-日 時:分:秒）
- 超出正常範圍的數值會以紅色標記提醒注意
- 可點擊「查看原始數據」連結查看每筆記錄的詳細原始數據

### 4. 查看原始數據
- 在歷史記錄頁面，點擊對應記錄的「查看原始數據」連結
- 系統將顯示詳細的原始十六進制數據和ASCII數據
- 原始數據頁面優化中文字符顯示，並提供清晰的格式化顯示
- 這些數據對專業分析和排障非常有用

## 四、進階設置

### 1. 血壓機型號設置
- 點擊主頁面上的「型號設定」按鈕
- 從下拉菜單中選擇您的血壓機型號
- 目前僅支援 OMRON-HBP9030 型號，未來將擴展支援其他型號
- 選擇完成後點擊「儲存設定」按鈕

### 2. 重置設備
- 如需重置WiFi設定，可以點擊頁面底部的「重置WiFi設定」
- 或長按ESP32上的重置按鈕（GPIO0）3秒以上
- 重置後設備會回到初始狀態，需要重新配置WiFi

### 3. 清除歷史記錄
- 在歷史記錄頁面點擊「清除記錄」按鈕
- 確認後將刪除所有保存的測量數據

## 五、故障排除

### 1. 無法連接WiFi
- 確認您輸入的WiFi名稱和密碼正確
- 確認WiFi信號強度足夠
- 如無法解決，可重置設備並重新配置

### 2. 無法讀取血壓數據
- 檢查ESP32與血壓機的TTL串口連接
- 確認連接至正確的GPIO引腳（RX: GPIO44, TX: GPIO43）
- 確認血壓機型號設置正確
- 重啟血壓機和ESP32

### 3. 網頁無法訪問
- 確認您的設備與ESP32在同一WiFi網絡下
- 嘗試使用IP地址直接訪問
- 如使用`bp_checker.local`無法訪問，某些設備可能不支持mDNS服務

### 4. 時間顯示不正確
- 確保您的ESP32能夠連接到互聯網以同步時間
- 如果時間不準確，重啟設備後等待幾分鐘讓NTP同步完成
- 系統使用台北時區（GMT+8）顯示時間

### 5. 原始數據顯示亂碼
- 確認瀏覽器支持UTF-8字符編碼
- 嘗試使用不同的瀏覽器（推薦Chrome或Firefox）
- 刷新頁面或清除瀏覽器緩存

## 六、技術規格
- 處理器：ESP32-S3
- 通訊：WiFi 2.4GHz
- 與血壓機通訊：TTL串口，9600 bps (RX: GPIO44, TX: GPIO43)
- 數據存儲：最多保存20筆測量記錄
- 時間記錄：使用NTP同步，台北時區（GMT+8）
- 網頁介面：響應式設計，支援各種螢幕尺寸
- 支援的血壓機型號：目前僅支援 OMRON-HBP9030
- 原始數據支持：顯示十六進制和ASCII格式的原始數據

## 七、更新日誌

### 2025-04-08 更新
- 將通訊接口從USB改為TTL串口（RX: GPIO44, TX: GPIO43）
- 優化原始數據顯示，解決中文亂碼問題
- 主頁面新增最近5筆數據表格顯示
- 改進網頁界面的通順度和易讀性
- 優化數據顯示格式和樣式
- 模組化代碼結構，提高可維護性

### 2025-04-05 更新
- 專案重組與重命名為bp_checker
- 解決編譯錯誤和相容性問題
- 增加歷史記錄容量至20筆
- 實現台北時區(GMT+8)時間記錄
- 完成基本使用手冊
